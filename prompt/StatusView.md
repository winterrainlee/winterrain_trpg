
# 📁 **상태 보기 모듈 (Status View Module)** Ver 1.5 (251207)
_(메인 프롬프트에서 `상태창` 입력 시 호출되는 전용 출력 모듈)_

이 모듈은 게임 도중 플레이어가 **"상태창"을 선택했을 때만** 실행된다.  
메인 엔진은 현재 세션의 JSON 상태(Core 스키마)를 이 모듈에 넘기고,  
이 모듈은 그것을 바탕으로 **여러 섹션의 표 형식**으로 상태를 출력한다.

> ⚠️ 이 모듈은 메타 정보(플레이어용 요약)를 보여주는 용도이므로,  
> Core의 “PC 시점 제한” 규칙에서 **예외**로 취급해도 된다.  
> 즉, PC가 모르는 수치·관계·세계 변화도 여기서는 보여줄 수 있다.

> ✅ 출력 규칙  
> - 플레이어에게 보여주는 모든 문장·표에는 JSON 필드명(`wf`, `ps`, `np` 등)을 사용하지 않는다.  

---

## 1. 호출 조건 및 역할

### 1-1. 호출 조건

다음 조건을 모두 만족할 때 이 모듈을 호출한다.

1. 플레이어 발화에 `상태창` 이라는 명령이 포함되어 있다.
2. 현재 세션 JSON이 Core 스키마에 맞게 유지되고 있다.
3. 이미 엔딩이 출력된 뒤가 아니다.  
   - 엔딩 이후에는 상태창 대신 “세션이 종료된 뒤라 상태를 갱신하지 않는다”는 안내를 우선한다.

### 1-2. 역할

- 메인 엔진에 저장된 JSON을 읽어, 다음을 한눈에 보여주는 요약 화면을 만든다.
  - 세계/배경 요약
  - PC의 기본 정보·말투·능력치·상태
  - 목표 진행 상황
  - 주요 NPC 관계
  - 세션 전체 진행 요약
- **상태창 출력 그 자체로는** 턴 수, 피로, 사기 등 JSON 값을 **변경하지 않는다.**

---

## 2. 입력 데이터 (JSON)

이 모듈이 받는 JSON의 최소 골격은 다음과 같다.

```jsonc
{
  "wf": {"ge": "","tl": "","rw": "","to": "","cc": ""},
  "wc": "",
  "ps": {
    "nm": "",
    "bg": "",
    "va": [],
    "tr": {"st": [],"fl": []},
    "ab": {"STR": 0,"DEX": 0,"CON": 0,"INT": 0,"WIS": 0,"CHA": 0},
    "md": {"STR": 0,"DEX": 0,"CON": 0,"INT": 0,"WIS": 0,"CHA": 0},
    "ss": {"hp": 100,"ft": 10,"mo": 60},
    "sr": {
      "hp": {"0": "사망"},
      "ft": {
        "0_5": "+1 전 판정",
        "15_18": "-1 전 판정",
        "19_20": "건강 -5",
        "default": "보정 없음",
        "r": {"re": -3,"ca": -6,"me": -4,"fo": -1}
      },
      "mo": {
        "80_100": "+1 전 판정",
        "0_20": "-1 전 판정",
        "default": "보정 없음",
        "u": {"su": 5,"go": 10,"npP": 5,"re": 3,"in": 10},
        "dn": {"fa": -5,"npN": -15,"bd": -10,"fe": -20}
      }
    },
    "gl": {
      "mg": "",
      "sg": "",
      "mc": false,
      "pr": {"sp": 0,"cs": [],"gp": 0}
    },
    "spk": ""
  },
  "np": {
    "{id}": {
      "nm": "","ro": "","re": "","at": 0,
      "ds": "","st": "","ls": "","fg": [],
      "tp": ""
    }
  },
  "tl": [
    {
      "t": 0,"ti": "","ts": "","lc": "","rc": null,"rs": "",
      "ef": {"hp": 0,"ft": 0,"gp": 0},
      "wc": [],
      "ni": [{"id": "","ch": 0,"cm": ""}],
      "sm": "",
      "nx": ""
    }
  ],
  "su": {"dp": 0,"tt": 0,"nc": 0,"wc": []}
}
```
-   누락된 필드는 **안전한 기본값**(예: 빈 문자열, 0, 빈 배열)로 간주하고 출력 형식만 최대한 유지한다.
-   `tl`이 비어 있다면, “아직 본편이 시작되지 않았습니다” 정도의 안내를 먼저 출력할 수 있다.
---

## 3. 출력 기본 구조

상태창 출력은 아래 섹션들로 구성된다.

1.  세계 요약
2.  플레이어 캐릭터 개요 + 말투
3.  능력치/보정치
4.  상태(건강/피로/사기 + 규칙 요약)
5.  목표 섹션
6.  NPC 관계 섹션
7.  진행 요약 섹션
    
각 섹션은 **마크다운 헤더 + 표** 형식으로 출력한다.

---

## 4. 섹션별 상세 규칙
### 4-1. 🌍 세계 요약 섹션
#### 4-1-1. 표 레이아웃

```
### 🌍 세계 요약

| 항목           | 내용          |
|----------------|---------------|
| 장르           | {wf.ge}       |
| 시대/기술 수준 | {wf.tl}       |
| 참조 세계      | {wf.rw}       |
| 분위기         | {wf.to}       |
| 핵심 갈등      | {wf.cc}       |
```
값이 비었으면 `"미설정"` 또는 적절한 기본 문구로 채운다.

#### 4-1-2. 맥락 요약
`wc`를 2~4문장 정도로 요약해서 바로 아래에 붙인다.

```markdown
세계 배경 요약:
{wc_요약_또는_원문}
```
---

### 4-2. 🙋 플레이어 캐릭터 개요 + 말투
#### 4-2-1. 기본 정보 표

```
### 🙋 플레이어 캐릭터
| 항목     | 내용        |
|----------|-------------|
| 이름     | {ps.nm}     |
| 배경     | {ps.bg}     |
| 가치관   | {ps.va_요약}|
| 강점     | {ps.tr.st_joined} |
| 결함     | {ps.tr.fl_joined} |
| 기본 말투| {ps.spk}    |
```
-   `ps.va_요약`은 리스트를 `,` 로 묶어서 한 줄로 보여준다.
-   `ps.tr.st_joined` / `ps.tr.fl_joined`도 마찬가지로 쉼표로 묶는다.
-   `ps.spk` 값(예: "반말", "해요체", "합쇼체" 등)을 그대로 표시한다.
    -   필요하면 `"반말 (친한 친구에게 쓰는 편한 말투)"`처럼 괄호로 짧게 부연 가능.

---

### 4-3. 📊 능력치 & 보정치 섹션

```
### 📊 능력치
| 능력 | 의미   | 값       | 보정치   |
|------|--------|----------|----------|
| STR  | 힘     | {ps.ab.STR} | {ps.md.STR} |
| DEX  | 민첩   | {ps.ab.DEX} | {ps.md.DEX} |
| CON  | 체력   | {ps.ab.CON} | {ps.md.CON} |
| INT  | 지능   | {ps.ab.INT} | {ps.md.INT} |
| WIS  | 통찰   | {ps.ab.WIS} | {ps.md.WIS} |
| CHA  | 매력   | {ps.ab.CHA} | {ps.md.CHA} |
```
-   능력치나 보정치가 0이면 `0` 그대로 출력.
-   일부 값이 누락되면 `-` 또는 `?`로 표시 가능.

아래에 Core 규칙을 짧게 상기:

```markdown
> 판정 공식: 1D20 + 보정치 ≥ DC(10~22)  
> 능력치/보정치는 게임 내 서술에서 직접 언급하지 않고, 묘사로만 표현한다.
```
---

### 4-4. ❤️ 상태 섹션
#### 4-4-1. 기본 상태 표
```
### ❤️ 상태

| 항목 | 값    | 설명                           |
|------|-------|--------------------------------|
| 건강 | {ps.ss.hp} | 0이 되면 사망                  |
| 피로 | {ps.ss.ft} | 높을수록 행동에 패널티 발생 가능 |
| 사기 | {ps.ss.mo} | 낮을수록 판단·행동 위축         |
```

### 4-5. 🎯 목표 섹션

#### 4-5-1. 표 레이아웃

```
### 🎯 목표
| 항목                    | 내용                          |
|-------------------------|-------------------------------|
| 장기 목표               | {ps.gl.mg}                    |
| 현재 단기 목표          | {ps.gl.sg}                    |
| 단기 목표 진행도        | {ps.gl.pr.sp}%                |
| 완료한 단기 목표        | {ps.gl.pr.cs_joined}          |
| 전체 목표 진행도(서사)  | {ps.gl.pr.gp}%                |
| 장기 목표 달성 여부     | {ps.gl.mc ? "달성" : "미달성"} |
```
-   `ps.gl.pr.cs_joined`는 완료한 단기 목표 배열을 `,` 로 합친 문자열.
-   Core 규칙 상:
    -   `ps.gl.pr.sp == 100` 된 턴에 단기 목표 달성 처리 및 피로 조정.
    -   `ps.gl.mc == true`면 엔딩 후보.
 
---

### 4-6. 👥NPC 관계 섹션
`np`의 각 항목을 한 줄씩 요약해서 표로 보여준다.

```
### 👥 NPC 관계
| 이름  | 역할        | 관계        | 말투    | 호감도 | 상태/최근 상황                     |
|-------|-------------|-------------|---------|--------|-------------------------------------|
| {nm}  | {ro}        | {re}        | {tp}    | {at}   | {st_ls_fg_요약}                     |
```
-   `tp`: 이 NPC가 플레이어에게 말할 때 쓰는 기본 말투
    -   예: `"합쇼체"`, `"해요체"`, `"반말"`, `"하게체"`, `"하오체"`
-   `st_ls_fg_요약` 구성:
    -   `st`(현재 상태)
    -   `ls`(마지막으로 본 시점/장소)
    -   `fg` 태그 중 핵심 1~2개
    -   예: `"부상 회복 중 (마지막 만남: 어제 밤, 성문 앞 / 태그: 동료, 의심)"`

NPC가 하나도 없을 경우, 대신 아래 한 줄만 출력한다.
```
현재까지 기록된 NPC가 없습니다.
```

---

### 4-7. 📜 진행 요약 섹션
`su`와 `tl` 마지막 항목을 사용해 세션 전체 진행 상황을 요약한다.

```
### 📜 진행 요약
| 항목                 | 값                 |
|----------------------|--------------------|
| 총 진행 턴 수        | {su.tt}            |
| 경과 일수            | {su.dp}일          |
| 기록된 세계 변화 수  | {len(su.wc)}       |
| 기록된 NPC 수        | {su.nc}            |
```

필요하면, `su.wc`에서 최근 2~3개를 골라 한 줄씩 보여준다.
```
최근 세계 변화:

- {세계변화1 요약}
- {세계변화2 요약}
- ...
```
`tl`이 비어 있지 않다면, 마지막 턴 제목/장소도 간단히 보여줄 수 있다.
```
최근 턴:
- 턴 {마지막 tl.t}: "{마지막 tl.ti}" @ {마지막 tl.lc}
```

---

## 5. 부가 규칙

-   상태창은 **게임 시간·턴 진행에 영향을 주지 않는다.**
-   출력은 어디까지나 플레이어용 메타 정보이므로,
    -   Core의 “능력치/상태 수치 언급 금지” 규칙에서 예외
    -   Core의 “PC 시점 제한” 규칙에서도 예외로 동작해도 된다.
-   다만, 상태창에서 드러난 정보(예: NPC 호감도 숫자)를  게임 내 서술에서 그대로 언급하지는 말고,  
    “예전보다 태도가 부드러워졌다” 같은 묘사로만 반영한다.
---

# 🔚 상태 보기 모듈 끝
